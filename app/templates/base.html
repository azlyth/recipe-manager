<!doctype html>

<title>{% block title %}{% endblock %} - My Recipe Manager</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<link href="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/css/select2.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/js/select2.min.js"></script>

<nav>
    <h1>My Recipe Manager</h1>
    <ul>
        {% if g.user %}
            <li><span>{{ g.user['username'] }}</span>
            <li><a href="{{ url_for('auth.logout') }}">Log Out</a>
                {% else %}
            <li><a href="{{ url_for('auth.register') }}">Register</a>
            <li><a href="{{ url_for('auth.login') }}">Log In</a>
        {% endif %}
    </ul>
</nav>
<section class="content">
    <header>
        {% block header %}{% endblock %}
    </header>
    {% for message in get_flashed_messages() %}
        <div class="flash">{{ message }}</div>
    {% endfor %}
    {% block content %}{% endblock %}
</section>

<script type="text/javascript">

    /*
    This script is identical to the above JavaScript function.
    */
    var ct = 1;

    function newlink() {
        ct++;
        var div1 = document.createElement('div');
        div1.id = ct;
        div1.classList.add('ingredient');
        // link to delete extended form elements
        var delLink = '<a href="javascript:newlink()">Add New</a>  <a href="javascript:delIt(' + ct + ')">Delete</a>';
        div1.innerHTML = document.getElementById('newlinktpl').innerHTML + delLink;
        document.getElementById('1').appendChild(div1);
    }

    // function to delete the newly added set of elements
    function delIt(eleId) {
        d = document;
        var ele = d.getElementById(eleId);
        var parentEle = d.getElementById('1');
        parentEle.removeChild(ele);
    }

    function handleSubmit(e) {

        e.preventDefault();
        var data = {};

        data.title = document.getElementById("title").value;
        data.servings = document.getElementById("servings").value;
        data.ingredients = [];
        data.instructions = document.getElementById("instructions").value;

        var ingredients = document.getElementsByClassName('ingredient');

        for (let ingredient of ingredients) {
            let ing = {};
            ing.ingName = ingredient.querySelector(".ing").value;
            ing.quantity = ingredient.querySelector(".quantity").value;
            ing.portion = ingredient.querySelector(".portion_size_unit").value;
            data.ingredients.push(ing);
        }

        fetch('/recipes/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            body: JSON.stringify(data)
        });

        alert(JSON.stringify(data));

    }
</script>

<script type="text/javascript">
    $(document).ready(function () {
        $('.js-example-basic-single').select2();
    });
</script>


